<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>ข้อมูลผู้สมัครวิ่ง</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-pink-50 min-h-screen p-4">

  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-6 text-center text-pink-700">รายชื่อผู้สมัครวิ่ง</h1>

    <div class="flex flex-col md:flex-row justify-between gap-4 mb-4">
      <input
        id="searchInput"
        type="text"
        placeholder="ค้นหาชื่อ-สกุล..."
        class="px-4 py-2 border rounded w-full md:w-1/3"
      />

      <select id="typeFilter" class="px-4 py-2 border rounded w-full md:w-1/4">
        <option value="">-- เลือกประเภท --</option>
      </select>

      <select id="ageFilter" class="px-4 py-2 border rounded w-full md:w-1/4">
        <option value="">-- เลือกรุ่นอายุ --</option>
      </select>
    </div>

    <div class="overflow-x-auto bg-white rounded shadow">
      <table class="min-w-full text-left">
        <thead class="bg-pink-200 text-pink-900">
          <tr>
            <th class="p-3">ชื่อ-สกุล</th>
            <th class="p-3">ประเภท</th>
            <th class="p-3">รุ่นอายุ</th>
          </tr>
        </thead>
        <tbody id="tableBody" class="divide-y"></tbody>
      </table>
    </div>
  </div>

<script>
let data = [];

async function loadData() {
  const res = await fetch('data.json');
  if (!res.ok) {
    console.error('Failed to load data.json:', res.status);
    return;
  }
  data = await res.json();
  console.log('Loaded data:', data);
  populateFilters();
  renderTable();
}

function populateFilters() {
  const typeSet = new Set();
  const ageSet = new Set();

  data.forEach(row => {
    if (row["ประเภท"]) typeSet.add(row["ประเภท"]);
    if (row["รุ่นอายุ"]) ageSet.add(row["รุ่นอายุ"]);
  });

  const typeFilter = document.getElementById('typeFilter');
  typeFilter.innerHTML = '<option value="">-- เลือกประเภท --</option>';
  typeSet.forEach(type => {
    const opt = document.createElement('option');
    opt.value = type;
    opt.textContent = type;
    typeFilter.appendChild(opt);
  });

  updateAgeFilterByType('');
}

function updateAgeFilterByType(selectedType) {
  const ageFilter = document.getElementById('ageFilter');
  ageFilter.innerHTML = '<option value="">-- เลือกรุ่นอายุ --</option>';

  const filteredAges = new Set();

  data.forEach(row => {
    if (!selectedType || row["ประเภท"] === selectedType) {
      if (row["รุ่นอายุ"]) filteredAges.add(row["รุ่นอายุ"]);
    }
  });

  filteredAges.forEach(age => {
    const opt = document.createElement('option');
    opt.value = age;
    opt.textContent = age;
    ageFilter.appendChild(opt);
  });
}

function renderTable() {
  const keyword = document.getElementById('searchInput').value.toLowerCase();
  const selectedType = document.getElementById('typeFilter').value;
  const selectedAge = document.getElementById('ageFilter').value;

  const tbody = document.getElementById('tableBody');
  tbody.innerHTML = "";

  const filtered = data.filter(row => {
    const name = (row["ชื่อ-สกุล Name"] || "").toLowerCase();
    const type = row["ประเภท"] || "";
    const ageGroup = row["รุ่นอายุ"] || "";

    const matchesName = name.includes(keyword);
    const matchesType = !selectedType || type === selectedType;
    const matchesAge = !selectedAge || ageGroup === selectedAge;

    return matchesName && matchesType && matchesAge;
  });

  for (const row of filtered) {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="p-3">${row["ชื่อ-สกุล Name"] || ""}</td>
      <td class="p-3">${row["ประเภท"] || ""}</td>
      <td class="p-3">${row["รุ่นอายุ"] || ""}</td>
    `;
    tbody.appendChild(tr);
  }
}

document.getElementById('typeFilter').addEventListener('change', () => {
  const selectedType = document.getElementById('typeFilter').value;
  updateAgeFilterByType(selectedType);
  renderTable();
});

document.getElementById('searchInput').addEventListener('input', renderTable);
document.getElementById('ageFilter').addEventListener('change', renderTable);

loadData();
</script>

</body>
</html>
